name: Wolfictl Update From Release Monitor

on:
  workflow_dispatch:
  # Triggers the workflow every hour
  schedule:
    - cron: "0 * * * *"

permissions:
  contents: read
  id-token: write

env:
  GIT_AUTHOR_NAME: frosh-ci
  GIT_AUTHOR_EMAIL: ci@fos.gg

jobs:
  update:
    name: Wolfictl Update
    if: github.repository == 'shyim/wolfi-php'
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@0c366fd6a839edf440554fa01a7085ccba70ac98 # v5.0.1

    - uses: octo-sts/action@f603d3be9d8dd9871a265776e625a27b00effe05 # v1.1.1
      id: octo-sts
      with:
        scope: ${{ github.repository }}
        identity: release-monitoring-updates

    - uses: ./.github/action/wolfictl-update-rm
      with:
        repository: ${{ github.repository }}
        release_monitor_token: ${{ secrets.RELEASE_MONITOR_TOKEN }}
        token: ${{ steps.octo-sts.outputs.token }}
        git_author_name: ${{ env.GIT_AUTHOR_NAME }}
        git_author_email: ${{ env.GIT_AUTHOR_EMAIL }}
